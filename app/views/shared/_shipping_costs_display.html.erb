<% content_for(:after_js) do %>
  <script>
    $(document).ready(function() {
      var total = <%= @amount.to_f %>;
      var weight = <%= @weight %>;
      var urlRoot = "<%= root_url %>";

      $('.payment-form input').on('click', function(event) {
        if ($('h3.total_amount').hasClass('take_away-checked')) {
          $('.shipping-cost').css({'visibility':'visible'});
          $('.total_amount').removeClass('take_away-checked')

          var country = $('#user_country').val();
          var url_params = "?country=" + country + "&weight=" + weight
          fetch(urlRoot + "/api/v1/shipping_categories/show" + url_params).then(response_api =>response_api.json()).then((data_api) => {
            value = (total * 100 + data_api.price_cents) / 100
            $('.total_amount').text('Montant total: '+ String(value).replace(".", ",") + " €")
          });

        } else {
          $('.shipping-cost').css({'visibility':'hidden'});
          $('.total_amount').addClass('take_away-checked')
          $('.total_amount').text('Montant total: '+ String(total).replace(".", ",") + " €")
        }
      });

    $('#user_country').on('change', function(event) {
      var country = $('#user_country').val();
      var url_params = "?country=" + country + "&weight=" + weight

      fetch(urlRoot + "/api/v1/shipping_categories/show" + url_params).then(response_api =>response_api.json()).then((data_api) => {
          $('.port-cost').text(String(data_api.price_cents / 100).replace(".", ",")+ " €")
          value = (total * 100 + data_api.price_cents) / 100
          $('.total_amount').text('Montant total: '+ String(value).replace(".", ",") + " €")
      });
    });

    });
  </script>
<% end %>
